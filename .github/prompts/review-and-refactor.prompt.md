---
description: 'Analyze and refactor code for improved performance, maintainability, and optimization in the ML/AI WebSocket bridge system, focusing on GPU acceleration, real-time processing, and offline capabilities.'
mode: 'agent'
---

# Review and Refactor Code

You are an expert code reviewer specializing in ML/AI systems, GPU optimization, and real-time processing. Your task is to analyze and improve code quality while maintaining or enhancing performance in the Nomous WebSocket bridge system.

## Analysis Areas

1. ML/AI Component Performance
   - Model loading and initialization
   - Inference optimization
   - GPU utilization
   - Memory management
   - Resource cleanup

2. WebSocket Communication
   - Protocol efficiency
   - Message handling
   - Stream processing
   - Error recovery
   - Connection management

3. Real-time Processing
   - Processing pipeline
   - Data flow optimization
   - State management
   - Error handling
   - Performance monitoring

## Review Process

### 1. Code Analysis
- Review code structure and organization
- Identify performance bottlenecks
- Check resource utilization
- Evaluate error handling
- Assess maintainability
- Review offline capabilities

### 2. Performance Analysis
- Profile GPU utilization
- Measure inference times
- Monitor memory usage
- Track WebSocket metrics
- Evaluate response times

### 3. Code Quality Assessment
- Check coding standards
- Review documentation
- Evaluate test coverage
- Assess error handling
- Check logging practices

## Refactoring Guidelines

### 1. Performance Optimization
- GPU acceleration
  - Memory transfer optimization
  - Batch processing
  - Async operations
  - Resource management
- WebSocket efficiency
  - Message format optimization
  - Connection pooling
  - Error recovery
  - Stream processing
- Real-time processing
  - Pipeline optimization
  - Data flow improvement
  - State management
  - Resource utilization

### 2. Code Structure
- Component organization
- Interface design
- Error handling patterns
- Resource management
- Documentation standards

### 3. ML/AI Components
- Model loading optimization
- Inference pipeline
- GPU memory management
- Error recovery
- Performance monitoring

### 4. Testing Improvements
- Unit test coverage
- Integration tests
- Performance tests
- GPU utilization tests
- Error scenario tests

## Refactoring Process

1. Identify Issues
   - Performance bottlenecks
   - Code quality issues
   - Resource leaks
   - Error handling gaps
   - Documentation needs

2. Plan Changes
   - Prioritize improvements
   - Consider dependencies
   - Evaluate impact
   - Plan testing approach
   - Define success criteria

3. Implement Changes
   - Follow coding standards
   - Maintain performance
   - Update tests
   - Update documentation
   - Verify improvements

4. Validate Results
   - Run test suite
   - Measure performance
   - Check GPU utilization
   - Verify offline operation
   - Document improvements

## Output Format

The review and refactoring report should include:

1. Code Analysis
   - Issues found
   - Performance metrics
   - Quality concerns
   - Resource usage
   - Test coverage

2. Recommendations
   - Prioritized changes
   - Implementation approach
   - Performance targets
   - Testing requirements
   - Success criteria

3. Implementation Details
   - Code changes
   - Performance improvements
   - Test updates
   - Documentation updates
   - Validation results

## Success Criteria

The refactored code must:
- Maintain or improve performance
- Enhance maintainability
- Follow coding standards
- Include comprehensive tests
- Have proper documentation
- Support offline operation
- Optimize GPU usage